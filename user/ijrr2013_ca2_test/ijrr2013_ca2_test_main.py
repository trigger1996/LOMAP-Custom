import networkx
import logging

from lomap import Ts


run_case_2 = [('u1', 'u2', '11'),  ('4', '10', ('11', '12', 2)),  ('5', '11', ('11', '12', 3)),  ('27', ('11', '12', 1), '12'),  (('27', '28', 1), ('11', '12', 2), '1'),  (('27', '28', 2), ('11', '12', 3), '2'),  ('28', '12', '21'),  (('28', '21', 1), '1', ('21', '22', 1)),  (('28', '21', 2), '2', '22'),  ('21', '21', ('22', '23', 1)),  (('21', '22', 1), ('21', '22', 1), '23'),  ('22', '22', '9'),  ('g1', 'g1', '10'),  (('g1', '22', 1), ('g1', '22', 1), '11'),  ('22', '22', ('11', '12', 1)),  ('23', '23', ('11', '12', 3)),  ('9', '9', '12'),  ('10', '10', '1'),  ('u2', 'u2', '2'),  (('u2', '10', 1), ('u2', '10', 1), '21'),  ('10', '10', ('21', '22', 1)),  ('11', '11', '22'),  (('11', '12', 2), ('11', '12', 2), '23'),  (('11', '12', 3), ('11', '12', 3), '9'),  ('12', '12', '10'),  ('1', '1', '11'),  ('2', '2', ('11', '12', 1)),  ('21', '21', ('11', '12', 2)),  ('22', '22', '12'),  ('g1', 'g1', '1'),  (('g1', '22', 1), ('g1', '22', 1), '2'),  ('22', '22', '21'),  ('23', '23', '22'),  ('9', '9', ('22', '23', 1)),  ('10', '10', '23'),  ('u2', 'u2', '9'),  (('u2', '10', 1), ('u2', '10', 1), '10'),  ('10', '10', '11'),  ('11', '11', ('11', '12', 1)),  (('11', '12', 3), ('11', '12', 3), '12'),  ('12', '12', '1'),  ('1', '1', '2'),  ('2', '2', '21'),  ('21', '21', ('21', '22', 1)),  (('21', '22', 1), ('21', '22', 1), '22'),  ('22', '22', ('22', '23', 1)),  ('g1', 'g1', '23'),  (('g1', '22', 1), ('g1', '22', 1), '9'),  ('22', '22', '10'),  (('22', '23', 1), ('22', '23', 1), '11'),  ('23', '23', ('11', '12', 1)),  ('9', '9', ('11', '12', 2)),  ('10', '10', ('11', '12', 3)),  ('u2', 'u2', '12'),  (('u2', '10', 1), ('u2', '10', 1), '1'),  ('10', '10', '2'),  ('11', '11', '21'),  (('11', '12', 2), ('11', '12', 2), '22'),  ('12', '12', '23'),  ('1', '1', '9'),  ('2', '2', '10'),  ('21', '21', '11'),  ('22', '22', ('11', '12', 2)),  ('g1', 'g1', ('11', '12', 3)),  (('g1', '22', 1), ('g1', '22', 1), '12'),  ('22', '22', '1'),  (('22', '23', 1), ('22', '23', 1), '2'),  ('23', '23', '21'),  ('9', '9', ('21', '22', 1)),  ('10', '10', '22'),  ('u2', 'u2', ('22', '23', 1)),  (('u2', '10', 1), ('u2', '10', 1), '23'),  ('10', '10', '9'),  ('11', '11', '10'),  (('11', '12', 1), ('11', '12', 1), '11'),  ('12', '12', ('11', '12', 3)),  ('1', '1', '12'),  ('2', '2', '1'),  ('21', '21', '2'),  (('21', '22', 1), ('21', '22', 1), '21'),  ('22', '22', ('21', '22', 1)),  ('g1', 'g1', '22'),  ('22', '22', '23'),  (('22', '23', 1), ('22', '23', 1), '9'),  ('23', '23', '10'),  ('9', '9', '11'),  ('10', '10', ('11', '12', 1)),  ('u2', 'u2', ('11', '12', 2)),  ('10', '10', '12'),  ('11', '11', '1'),  (('11', '12', 1), ('11', '12', 1), '2'),  (('11', '12', 2), ('11', '12', 2), '21'),  ('12', '12', '22'),  ('1', '1', ('22', '23', 1)),  ('2', '2', '23'),  ('21', '21', '9'),  (('21', '22', 1), ('21', '22', 1), '10'),  ('22', '22', '11'),  ('g1', 'g1', ('11', '12', 1)),  ('22', '22', ('11', '12', 3)),  (('22', '23', 1), ('22', '23', 1), '12'),  ('23', '23', '1'),  ('9', '9', '2'),  ('10', '10', '21'),  ('u2', 'u2', ('21', '22', 1)),  (('u2', '10', 1), ('u2', '10', 1), '22'),  ('10', '10', ('22', '23', 1)),  ('11', '11', '23'),  (('11', '12', 1), ('11', '12', 1), '9'),  (('11', '12', 2), ('11', '12', 2), '10'),  (('11', '12', 3), ('11', '12', 3), '11'),  ('12', '12', ('11', '12', 1)),  ('1', '1', ('11', '12', 2)),  ('2', '2', ('11', '12', 3)),  ('21', '21', '12'),  (('21', '22', 1), ('21', '22', 1), '1'),  ('22', '22', '2'),  ('g1', 'g1', '21'),  ('22', '22', '22'),  ('23', '23', '23'),  ('9', '9', '9'),  ('10', '10', '10'),  ('u2', 'u2', '11'),  ('10', '10', ('11', '12', 2)),  ('11', '11', ('11', '12', 3)),  (('11', '12', 1), ('11', '12', 1), '12'),  (('11', '12', 2), ('11', '12', 2), '1'),  (('11', '12', 3), ('11', '12', 3), '2'),  ('12', '12', '21'),  ('1', '1', ('21', '22', 1)),  ('2', '2', '22'),  ('21', '21', ('22', '23', 1))]
run_case_3 = [('u1', 'u2', '11'), ('4', '10', ('11', '12', 2)), ('u1', 'u2', ('11', '12', 3)), (('u1', '4', 1), ('u2', '10', 1), '12'), ('4', '10', '1'), ('5', '11', '2'), ('27', '23', '21'), (('27', '28', 2), ('23', '24', 2), '22'), ('28', '24', ('22', '23', 1)), (('28', '21', 1), ('24', '25', 1), '23'), (('28', '21', 2), ('24', '25', 2), '9'), ('21', '25', '10'), (('21', '22', 1), ('25', '26', 1), '11'), ('22', '26', ('11', '12', 1)), ('g1', 'g3', ('11', '12', 2)), ('22', '26', '12'), (('22', '23', 1), ('26', '27', 1), '1'), ('23', '27', '2'), ('9', '3', '21'), ('10', '4', ('21', '22', 1)), ('u2', 'u1', '22'), ('10', '4', '23'), ('11', '5', '9'), (('11', '12', 1), ('5', '6', 1), '10'), (('11', '12', 2), ('5', '6', 2), '11'), ('12', '6', ('11', '12', 2)), ('1', '7', ('11', '12', 3)), ('2', '8', '12'), ('21', '25', '1'), (('21', '22', 1), ('25', '26', 1), '2'), ('22', '26', '21'), ('g1', 'g3', ('21', '22', 1)), (('g1', '22', 1), ('g3', '26', 1), '22'), ('22', '26', ('22', '23', 1)), (('22', '23', 1), ('26', '27', 1), '23'), ('23', '27', '9'), ('9', '3', '10'), ('10', '4', '11'), ('u2', 'u1', ('11', '12', 1)), ('10', '4', ('11', '12', 3)), ('11', '5', '12'), (('11', '12', 1), ('5', '6', 1), '1'), (('11', '12', 2), ('5', '6', 2), '2'), (('11', '12', 3), ('5', '6', 3), '21'), ('12', '6', ('21', '22', 1)), ('1', '7', '22'), ('2', '8', ('22', '23', 1)), ('21', '25', '23'), (('21', '22', 1), ('25', '26', 1), '9'), ('22', '26', '10'), ('g1', 'g3', '11'), ('22', '26', ('11', '12', 2)), ('23', '27', '12'), ('9', '3', '1'), ('10', '4', '2'), ('u2', 'u1', '21'), ('10', '4', '22'), ('11', '5', ('22', '23', 1)), (('11', '12', 1), ('5', '6', 1), '23'), (('11', '12', 2), ('5', '6', 2), '9'), (('11', '12', 3), ('5', '6', 3), '10'), ('12', '6', '11'), ('1', '7', ('11', '12', 1)), ('2', '8', ('11', '12', 2)), ('21', '25', ('11', '12', 3)), (('21', '22', 1), ('25', '26', 1), '12'), ('22', '26', '1'), ('g1', 'g3', '2'), (('g1', '22', 1), ('g3', '26', 1), '21'), ('22', '26', ('21', '22', 1)), (('22', '23', 1), ('26', '27', 1), '22'), ('23', '27', ('22', '23', 1)), ('9', '3', '23'), ('10', '4', '9'), ('u2', 'u1', '10'), (('u2', '10', 1), ('u1', '4', 1), '11'), ('10', '4', ('11', '12', 1)), ('11', '5', ('11', '12', 2)), (('11', '12', 2), ('5', '6', 2), '12'), (('11', '12', 3), ('5', '6', 3), '1'), ('12', '6', '2'), ('1', '7', '21'), ('2', '8', ('21', '22', 1)), ('21', '25', '22'), ('22', '26', '23'), ('g1', 'g3', '9'), (('g1', '22', 1), ('g3', '26', 1), '10'), ('22', '26', '11'), ('23', '27', ('11', '12', 2)), ('9', '3', ('11', '12', 3)), ('10', '4', '12'), ('u2', 'u1', '1'), (('u2', '10', 1), ('u1', '4', 1), '2'), ('10', '4', '21'), ('11', '5', ('21', '22', 1)), (('11', '12', 1), ('5', '6', 1), '22'), (('11', '12', 3), ('5', '6', 3), '23'), ('12', '6', '9'), ('1', '7', '10'), ('2', '8', '11'), ('21', '25', ('11', '12', 1)), ('22', '26', ('11', '12', 3)), ('g1', 'g3', '12'), (('g1', '22', 1), ('g3', '26', 1), '1'), ('22', '26', '2'), (('22', '23', 1), ('26', '27', 1), '21'), ('23', '27', ('21', '22', 1)), ('9', '3', '22'), ('10', '4', ('22', '23', 1)), ('u2', 'u1', '23'), (('u2', '10', 1), ('u1', '4', 1), '9'), ('10', '4', '10'), ('11', '5', '11'), ('12', '6', '12'), ('1', '7', '1'), ('2', '8', '2'), ('21', '25', '21'), ('22', '26', '22'), ('g1', 'g3', ('22', '23', 1)), (('g1', '22', 1), ('g3', '26', 1), '23'), ('22', '26', '9'), (('22', '23', 1), ('26', '27', 1), '10'), ('23', '27', '11'), ('9', '3', ('11', '12', 1)), ('10', '4', ('11', '12', 2)), ('u2', 'u1', ('11', '12', 3)), (('u2', '10', 1), ('u1', '4', 1), '12'), ('10', '4', '1'), ('11', '5', '2'), (('11', '12', 1), ('5', '6', 1), '21'), (('11', '12', 3), ('5', '6', 3), '22'), ('12', '6', ('22', '23', 1)), ('1', '7', '23'), ('2', '8', '9'), ('21', '25', '10')]
run_case_4 = [('u1', 'u2', '11'), ('4', '10', ('11', '12', 2)), ('u1', 'u2', ('11', '12', 3)), (('u1', '4', 1), ('u2', '10', 1), '12'), ('4', '10', '1'), ('5', '11', '2'), ('27', '23', '21'), (('27', '28', 2), ('23', '24', 2), '22'), ('28', '24', ('22', '23', 1)), ('g4', 'g2', '23'), (('g4', '28', 1), ('g2', '24', 1), '9'), ('28', '24', '10'), (('28', '21', 1), ('24', '25', 1), '11'), ('21', '25', ('11', '12', 2)), ('12', '6', ('11', '12', 3)), ('1', '7', '12'), ('2', '8', '1'), (('2', '3', 1), ('8', '9', 1), '2'), (('2', '3', 2), ('8', '9', 2), '21'), (('2', '3', 4), ('8', '9', 4), '22'), ('3', '9', '23'), ('4', '10', '9'), ('u1', 'u2', '10'), (('u1', '4', 1), ('u2', '10', 1), '11'), ('4', '10', ('11', '12', 1)), ('5', '11', ('11', '12', 2)), ('27', '23', ('11', '12', 3)), (('27', '28', 1), ('23', '24', 1), '12'), (('27', '28', 2), ('23', '24', 2), '1'), ('28', '24', '2'), ('g4', 'g2', '21'), ('28', '24', '22'), (('28', '21', 2), ('24', '25', 2), '23'), ('21', '25', '9'), ('12', '6', '10'), ('1', '7', '11'), ('2', '8', ('11', '12', 1)), (('2', '3', 3), ('8', '9', 3), '12'), (('2', '3', 4), ('8', '9', 4), '1'), (('2', '3', 5), ('8', '9', 5), '2'), ('3', '9', '21'), ('4', '10', ('21', '22', 1)), ('u1', 'u2', '22'), ('4', '10', '23'), ('5', '11', '9'), ('27', '23', '10'), (('27', '28', 1), ('23', '24', 1), '11'), ('28', '24', ('11', '12', 2)), ('g4', 'g2', ('11', '12', 3)), (('g4', '28', 1), ('g2', '24', 1), '12'), ('28', '24', '1'), (('28', '21', 1), ('24', '25', 1), '2'), (('28', '21', 2), ('24', '25', 2), '21'), ('21', '25', ('21', '22', 1)), ('12', '6', '22'), ('1', '7', ('22', '23', 1)), ('2', '8', '23'), (('2', '3', 1), ('8', '9', 1), '9'), (('2', '3', 2), ('8', '9', 2), '10'), (('2', '3', 3), ('8', '9', 3), '11'), ('3', '9', ('11', '12', 3)), ('4', '10', '12'), ('u1', 'u2', '1'), (('u1', '4', 1), ('u2', '10', 1), '2'), ('4', '10', '21'), ('5', '11', ('21', '22', 1)), ('27', '23', '22'), (('27', '28', 2), ('23', '24', 2), '23'), ('28', '24', '9'), ('g4', 'g2', '10'), (('g4', '28', 1), ('g2', '24', 1), '11'), ('28', '24', ('11', '12', 1)), ('21', '25', '12'), ('12', '6', '1'), ('1', '7', '2'), ('2', '8', '21'), (('2', '3', 2), ('8', '9', 2), '22'), (('2', '3', 4), ('8', '9', 4), '23'), (('2', '3', 5), ('8', '9', 5), '9'), ('3', '9', '10'), ('4', '10', '11'), ('u1', 'u2', ('11', '12', 1)), ('4', '10', ('11', '12', 3)), ('5', '11', '12'), ('27', '23', '1'), (('27', '28', 1), ('23', '24', 1), '2'), (('27', '28', 2), ('23', '24', 2), '21'), ('28', '24', ('21', '22', 1)), ('g4', 'g2', '22'), ('28', '24', '23'), (('28', '21', 1), ('24', '25', 1), '9'), (('28', '21', 2), ('24', '25', 2), '10'), ('21', '25', '11'), ('12', '6', ('11', '12', 1)), ('1', '7', ('11', '12', 2)), ('2', '8', ('11', '12', 3)), (('2', '3', 1), ('8', '9', 1), '12'), (('2', '3', 2), ('8', '9', 2), '1'), (('2', '3', 3), ('8', '9', 3), '2'), (('2', '3', 4), ('8', '9', 4), '21'), ('3', '9', '22'), ('4', '10', ('22', '23', 1)), ('u1', 'u2', '23'), (('u1', '4', 1), ('u2', '10', 1), '9'), ('4', '10', '10'), ('5', '11', '11'), ('27', '23', ('11', '12', 1)), ('28', '24', '12'), ('g4', 'g2', '1'), (('g4', '28', 1), ('g2', '24', 1), '2'), ('28', '24', '21'), (('28', '21', 2), ('24', '25', 2), '22'), ('21', '25', ('22', '23', 1)), ('12', '6', '23'), ('1', '7', '9'), ('2', '8', '10'), (('2', '3', 1), ('8', '9', 1), '11'), (('2', '3', 5), ('8', '9', 5), '12'), ('3', '9', '1'), ('4', '10', '2'), ('u1', 'u2', '21'), ('4', '10', '22'), ('5', '11', ('22', '23', 1)), ('27', '23', '23'), (('27', '28', 1), ('23', '24', 1), '9'), (('27', '28', 2), ('23', '24', 2), '10'), ('28', '24', '11'), ('g4', 'g2', ('11', '12', 1)), ('28', '24', ('11', '12', 3)), (('28', '21', 1), ('24', '25', 1), '12'), (('28', '21', 2), ('24', '25', 2), '1'), ('21', '25', '2'), ('12', '6', '21'), ('1', '7', ('21', '22', 1)), ('2', '8', '22'), (('2', '3', 2), ('8', '9', 2), '23'), (('2', '3', 3), ('8', '9', 3), '9'), (('2', '3', 4), ('8', '9', 4), '10'), (('2', '3', 5), ('8', '9', 5), '11'), ('3', '9', ('11', '12', 1)), ('4', '10', ('11', '12', 2)), ('u1', 'u2', ('11', '12', 3))]

# inv
run_case_2_inv = [('u1', 'u2', '11'), (('u1', '4', 1), ('u2', '10', 1), '10'), ('4', '10', '9'), ('u1', 'u2', '23'), ('4', '10', '22'), ('5', '11', ('22', '21', 1)), ('27', '23', '21'), (('27', '28', 1), ('23', '24', 1), '2'), (('27', '28', 2), ('23', '24', 2), '1'), ('28', '24', '12'), ('21', '25', ('12', '11', 3)), (('21', '22', 1), ('25', '26', 1), '11'), ('22', '26', '10'), ('g1', 'g3', '9'), (('g1', '22', 1), ('g3', '26', 1), '23'), ('22', '26', ('23', '22', 1)), (('22', '23', 1), ('26', '27', 1), '22'), ('23', '27', ('22', '21', 1)), ('9', '3', '21'), ('10', '4', '2'), ('u2', 'u1', '1'), (('u2', '10', 1), ('u1', '4', 1), '12'), ('10', '4', ('12', '11', 1)), ('11', '5', ('12', '11', 2)), (('11', '12', 1), '27', ('12', '11', 3)), (('11', '12', 2), ('27', '28', 1), '11'), (('11', '12', 3), ('27', '28', 2), '10'), ('12', '28', '9'), ('1', ('28', '21', 1), '23'), ('2', ('28', '21', 2), ('23', '22', 1)), ('21', '21', '22'), ('22', '22', '21'), ('g1', 'g1', '2'), (('g1', '22', 1), ('g1', '22', 1), '1'), ('22', '22', '12'), ('23', '23', ('12', '11', 2)), ('9', '9', ('12', '11', 3)), ('10', '10', '11'), ('u2', 'u2', '10'), (('u2', '10', 1), ('u2', '10', 1), '9'), ('10', '10', '23'), ('11', '11', ('23', '22', 1)), (('11', '12', 1), ('11', '12', 1), '22'), (('11', '12', 3), ('11', '12', 3), '21'), ('12', '12', '2'), ('1', '1', '1'), ('2', '2', '12'), ('21', '21', ('12', '11', 1)), ('22', '22', ('12', '11', 3)), ('g1', 'g1', '11'), (('g1', '22', 1), ('g1', '22', 1), '10'), ('22', '22', '9'), (('22', '23', 1), ('22', '23', 1), '23'), ('23', '23', ('23', '22', 1)), ('9', '9', '22'), ('10', '10', ('22', '21', 1)), ('u2', 'u2', '21'), (('u2', '10', 1), ('u2', '10', 1), '2'), ('10', '10', '1'), ('11', '11', '12'), ('12', '12', '11'), ('1', '1', '10'), ('2', '2', '9'), ('21', '21', '23'), ('22', '22', '22'), ('g1', 'g1', ('22', '21', 1)), (('g1', '22', 1), ('g1', '22', 1), '21'), ('22', '22', '2'), (('22', '23', 1), ('22', '23', 1), '1'), ('23', '23', '12'), ('9', '9', ('12', '11', 1)), ('10', '10', ('12', '11', 2)), ('u2', 'u2', ('12', '11', 3)), (('u2', '10', 1), ('u2', '10', 1), '11'), ('10', '10', '10'), ('11', '11', '9'), (('11', '12', 1), ('11', '12', 1), '23'), (('11', '12', 3), ('11', '12', 3), '22'), ('12', '12', ('22', '21', 1)), ('1', '1', '21'), ('2', '2', '2'), ('21', '21', '1'), (('21', '22', 1), ('21', '22', 1), '12'), ('22', '22', ('12', '11', 1)), ('g1', 'g1', ('12', '11', 2)), ('22', '22', '11'), (('22', '23', 1), ('22', '23', 1), '10'), ('23', '23', '9'), ('9', '9', '23'), ('10', '10', ('23', '22', 1)), ('u2', 'u2', '22'), ('10', '10', '21'), ('11', '11', '2'), (('11', '12', 1), ('11', '12', 1), '1'), (('11', '12', 2), ('11', '12', 2), '12'), ('12', '12', ('12', '11', 2)), ('1', '1', ('12', '11', 3)), ('2', '2', '11'), ('21', '21', '10'), (('21', '22', 1), ('21', '22', 1), '9'), ('22', '22', '23'), ('g1', 'g1', ('23', '22', 1)), (('g1', '22', 1), ('g1', '22', 1), '22'), ('22', '22', ('22', '21', 1)), (('22', '23', 1), ('22', '23', 1), '21'), ('23', '23', '2'), ('9', '9', '1'), ('10', '10', '12'), ('u2', 'u2', ('12', '11', 1)), ('10', '10', ('12', '11', 3)), ('11', '11', '11'), (('11', '12', 1), ('11', '12', 1), '10'), (('11', '12', 2), ('11', '12', 2), '9'), (('11', '12', 3), ('11', '12', 3), '23'), ('12', '12', ('23', '22', 1)), ('1', '1', '22'), ('2', '2', ('22', '21', 1)), ('21', '21', '21'), (('21', '22', 1), ('21', '22', 1), '2'), ('22', '22', '1'), ('g1', 'g1', '12'), ('22', '22', ('12', '11', 2)), ('23', '23', '11'), ('9', '9', '10'), ('10', '10', '9'), ('u2', 'u2', '23'), ('10', '10', '22'), ('11', '11', ('22', '21', 1)), (('11', '12', 1), '23', '21'), (('11', '12', 2), ('23', '24', 1), '2'), (('11', '12', 3), ('23', '24', 2), '1'), ('12', '24', '12'), ('1', ('24', '25', 1), ('12', '11', 1)), ('2', ('24', '25', 2), ('12', '11', 2)), ('21', '25', ('12', '11', 3))]
run_case_3_inv = [('u1', 'u2', '11'), (('u1', '4', 1), ('u2', '10', 1), '10'), ('4', '10', '9'), ('u1', 'u2', '23'), ('4', '10', '22'), ('5', '11', ('22', '21', 1)), ('27', '23', '21'), (('27', '28', 1), ('23', '24', 1), '2'), (('27', '28', 2), ('23', '24', 2), '1'), ('28', '24', '12'), ('21', '25', ('12', '11', 3)), (('21', '22', 1), ('25', '26', 1), '11'), ('22', '26', '10'), ('g1', 'g3', '9'), (('g1', '22', 1), ('g3', '26', 1), '23'), ('22', '26', ('23', '22', 1)), (('22', '23', 1), ('26', '27', 1), '22'), ('23', '27', ('22', '21', 1)), ('9', '3', '21'), ('10', '4', '2'), ('u2', 'u1', '1'), (('u2', '10', 1), ('u1', '4', 1), '12'), ('10', '4', ('12', '11', 1)), ('11', '5', ('12', '11', 2)), (('11', '12', 2), ('5', '6', 2), '11'), (('11', '12', 3), ('5', '6', 3), '10'), ('12', '6', '9'), ('1', '7', '23'), ('2', '8', ('23', '22', 1)), ('21', '25', '22'), ('22', '26', '21'), ('g1', 'g3', '2'), (('g1', '22', 1), ('g3', '26', 1), '1'), ('22', '26', '12'), ('23', '27', ('12', '11', 2)), ('9', '3', ('12', '11', 3)), ('10', '4', '11'), ('u2', 'u1', '10'), (('u2', '10', 1), ('u1', '4', 1), '9'), ('10', '4', '23'), ('11', '5', ('23', '22', 1)), (('11', '12', 1), ('5', '6', 1), '22'), (('11', '12', 3), ('5', '6', 3), '21'), ('12', '6', '2'), ('1', '7', '1'), ('2', '8', '12'), ('21', '25', ('12', '11', 1)), ('22', '26', ('12', '11', 3)), ('g1', 'g3', '11'), (('g1', '22', 1), ('g3', '26', 1), '10'), ('22', '26', '9'), (('22', '23', 1), ('26', '27', 1), '23'), ('23', '27', ('23', '22', 1)), ('9', '3', '22'), ('10', '4', ('22', '21', 1)), ('u2', 'u1', '21'), (('u2', '10', 1), ('u1', '4', 1), '2'), ('10', '4', '1'), ('11', '5', '12'), ('12', '6', '11'), ('1', '7', '10'), ('2', '8', '9'), ('21', '25', '23'), ('22', '26', '22'), ('g1', 'g3', ('22', '21', 1)), (('g1', '22', 1), ('g3', '26', 1), '21'), ('22', '26', '2'), (('22', '23', 1), ('26', '27', 1), '1'), ('23', '27', '12'), ('9', '3', ('12', '11', 1)), ('10', '4', ('12', '11', 2)), ('u2', 'u1', ('12', '11', 3)), (('u2', '10', 1), ('u1', '4', 1), '11'), ('10', '4', '10'), ('11', '5', '9'), (('11', '12', 1), ('5', '6', 1), '23'), (('11', '12', 3), ('5', '6', 3), '22'), ('12', '6', ('22', '21', 1)), ('1', '7', '21'), ('2', '8', '2'), ('21', '25', '1'), (('21', '22', 1), ('25', '26', 1), '12'), ('22', '26', ('12', '11', 1)), ('g1', 'g3', ('12', '11', 2)), ('22', '26', '11'), (('22', '23', 1), ('26', '27', 1), '10'), ('23', '27', '9'), ('9', '3', '23'), ('10', '4', ('23', '22', 1)), ('u2', 'u1', '22'), ('10', '4', '21'), ('11', '5', '2'), (('11', '12', 1), ('5', '6', 1), '1'), (('11', '12', 2), ('5', '6', 2), '12'), ('12', '6', ('12', '11', 2)), ('1', '7', ('12', '11', 3)), ('2', '8', '11'), ('21', '25', '10'), (('21', '22', 1), ('25', '26', 1), '9'), ('22', '26', '23'), ('g1', 'g3', ('23', '22', 1)), (('g1', '22', 1), ('g3', '26', 1), '22'), ('22', '26', ('22', '21', 1)), (('22', '23', 1), ('26', '27', 1), '21'), ('23', '27', '2'), ('9', '3', '1'), ('10', '4', '12'), ('u2', 'u1', ('12', '11', 1)), ('10', '4', ('12', '11', 3)), ('11', '5', '11'), (('11', '12', 1), ('5', '6', 1), '10'), (('11', '12', 2), ('5', '6', 2), '9'), (('11', '12', 3), ('5', '6', 3), '23'), ('12', '6', ('23', '22', 1)), ('1', '7', '22'), ('2', '8', ('22', '21', 1)), ('21', '25', '21'), (('21', '22', 1), ('25', '26', 1), '2'), ('22', '26', '1'), ('g1', 'g3', '12'), ('22', '26', ('12', '11', 2)), ('23', '27', '11'), ('9', '3', '10'), ('10', '4', '9'), ('u2', 'u1', '23'), ('10', '4', '22'), ('11', '5', ('22', '21', 1)), (('11', '12', 1), ('5', '6', 1), '21'), (('11', '12', 2), ('5', '6', 2), '2'), (('11', '12', 3), ('5', '6', 3), '1'), ('12', '6', '12'), ('1', '7', ('12', '11', 1)), ('2', '8', ('12', '11', 2)), ('21', '25', ('12', '11', 3))]





# real
run_case_4_real = [('u1', 'u2', '11'), ('4', '10', ('11', '12', 2)), ('5', '11', '12'), ('27', '23', '1'), (('27', '28', 2), ('23', '24', 2), '2'), ('28', '24', ('2', '21', 1)), ('g4', 'g2', '21'), ('28', '24', ('21', '22', 1)), (('28', '21', 2), ('24', '25', 2), '22'), ('21', '25', ('22', '23', 1)), ('12', '6', '23'), ('1', '7', '9'), ('2', '8', '10'), (('2', '3', 2), ('8', '9', 2), '11'), ('3', '9', ('11', '12', 2)), ('4', '10', '12'), ('u1', 'u2', '1'), ('4', '10', '2'), ('5', '11', '21'), ('27', '23', ('21', '22', 2)), (('27', '28', 1), ('23', '24', 1), '22'), ('28', '24', ('22', '23', 2)), ('g4', 'g2', '23'), ('28', '24', ('23', '9', 1)), (('28', '21', 1), ('24', '25', 1), '9'), ('21', '25', '10'), ('12', '6', '11'), ('1', '7', ('11', '12', 2)), ('2', '8', '12'), (('2', '3', 2), ('8', '9', 2), '1'), ('3', '9', '2'), ('4', '10', '21'), ('u1', 'u2', ('21', '22', 2)), (('u1', '4', 1), ('u2', '10', 1), '22'), ('4', '10', ('22', '23', 1)), ('5', '11', '23'), ('27', '23', '9'), (('27', '28', 2), ('23', '24', 2), '10'), ('28', '24', ('10', '11', 1)), ('g4', 'g2', '11'), ('28', '24', ('11', '12', 1)), ('21', '25', '12'), ('12', '6', '1'), ('1', '7', '2'), ('2', '8', '21'), (('2', '3', 3), ('8', '9', 3), '22'), ('3', '9', ('22', '23', 1)), ('4', '10', '23'), ('u1', 'u2', '9'), ('4', '10', '10'), ('5', '11', '11'), ('27', '23', ('11', '12', 2)), (('27', '28', 2), ('23', '24', 2), '12'), ('28', '24', ('12', '1', 1)), ('g4', 'g2', '1'), ('28', '24', ('1', '2', 1)), (('28', '21', 1), ('24', '25', 1), '2'), ('21', '25', '21'), ('12', '6', ('21', '22', 2)), (('12', '1', 1), ('6', '7', 1), '22'), ('1', '7', ('22', '23', 1)), ('2', '8', '23'), (('2', '3', 2), ('8', '9', 2), '9'), ('3', '9', '10'), ('4', '10', '11'), ('u1', 'u2', ('11', '12', 2)), ('4', '10', '12'), ('5', '11', '1'), ('27', '23', '2'), (('27', '28', 2), ('23', '24', 2), '21'), ('28', '24', ('21', '22', 1)), ('g4', 'g2', ('21', '22', 2)), ('28', '24', '22'), ('21', '25', '23'), ('12', '6', '9'), ('1', '7', '10'), ('2', '8', '11'), ('3', '9', '12'), ('4', '10', '1'), ('u1', 'u2', '2'), ('4', '10', '21'), ('5', '11', ('21', '22', 2)), (('5', '27', 1), ('11', '23', 1), '22'), ('27', '23', ('22', '23', 1)), (('27', '28', 2), ('23', '24', 2), '23'), ('28', '24', ('23', '9', 1)), ('g4', 'g2', '9'), ('28', '24', ('9', '10', 1)), (('28', '21', 1), ('24', '25', 1), '10'), ('21', '25', '11'), ('12', '6', ('11', '12', 2)), ('1', '7', '12'), ('2', '8', '1'), (('2', '3', 2), ('8', '9', 2), '2'), ('3', '9', '21'), ('4', '10', ('21', '22', 2)), (('4', 'u1', 1), ('10', 'u2', 1), '22'), ('u1', 'u2', ('22', '23', 1)), ('4', '10', '23'), ('5', '11', '9'), ('27', '23', '10'), (('27', '28', 2), ('23', '24', 2), '11'), ('28', '24', ('11', '12', 1)), ('g4', 'g2', ('11', '12', 2)), ('28', '24', ('11', '12', 3)), (('28', '21', 1), ('24', '25', 1), '12'), ('21', '25', '1'), ('12', '6', '2'), ('1', '7', '21'), ('2', '8', ('21', '22', 2)), (('2', '3', 1), ('8', '9', 1), '22'), ('3', '9', '23'), ('4', '10', '9'), ('u1', 'u2', '10'), ('4', '10', '11'), ('5', '11', ('11', '12', 2)), ('27', '23', '12'), (('27', '28', 2), ('23', '24', 2), '1'), ('28', '24', ('1', '2', 1)), ('g4', 'g2', '2'), ('28', '24', ('2', '21', 1)), (('28', '21', 1), ('24', '25', 1), '21'), ('21', '25', ('21', '22', 2)), (('21', '12', 1), ('25', '6', 1), '22'), ('12', '6', ('22', '23', 1)), ('1', '7', '23'), ('2', '8', '9'), (('2', '3', 2), ('8', '9', 2), '10'), ('3', '9', '11'), ('4', '10', ('11', '12', 2)), ('u1', 'u2', '12'), ('4', '10', '1'), ('5', '11', '2'), ('27', '23', '21'), ('28', '24', '22'), ('g4', 'g2', ('22', '23', 1)), ('28', '24', ('22', '23', 2)), (('28', '21', 1), ('24', '25', 1), '23'), ('21', '25', '9'), ('12', '6', '10'), ('1', '7', '11'), ('2', '8', ('11', '12', 2)), (('2', '3', 2), ('8', '9', 2), '12'), ('3', '9', '1'), ('4', '10', '2'), ('u1', 'u2', '21'), ('4', '10', ('21', '22', 2)), (('4', '5', 1), ('10', '11', 1), '22'), ('5', '11', ('22', '23', 1)), ('27', '23', '23'), (('27', '28', 2), ('23', '24', 2), '9'), ('28', '24', ('9', '10', 1)), ('g4', 'g2', '10'), ('28', '24', ('10', '11', 1)), (('28', '21', 1), ('24', '25', 1), '11'), ('21', '25', ('11', '12', 2)), ('12', '6', '12'), ('1', '7', '1'), ('2', '8', '2'), (('2', '3', 2), ('8', '9', 2), '21'), ('3', '9', ('21', '22', 2)), (('3', '4', 1), ('9', '10', 1), '22'), ('4', '10', ('22', '23', 1)), ('u1', 'u2', '23'), ('4', '10', '9'), ('5', '11', '10'), ('27', '23', '11'), ('28', '24', ('11', '12', 3)), ('g4', 'g2', '12'), ('28', '24', ('12', '1', 1)), (('28', '21', 1), ('24', '25', 1), '1'), ('21', '25', '2'), ('12', '6', '21'), ('1', '7', ('21', '22', 2)), (('1', '2', 1), ('7', '8', 1), '22'), ('2', '8', ('22', '23', 1)), (('2', '3', 2), ('8', '9', 2), '23'), ('3', '9', '9'), ('4', '10', '10'), ('u1', 'u2', '11')]

# etc
run_etc_case_3_1 = [('u1', 'u2', '11'), ('4', '10', ('11', '12', 2)), ('u1', 'u2', ('11', '12', 3)), (('u1', '4', 1), ('u2', '10', 1), '12'), ('4', '10', ('12', '1', 1)), ('5', '11', '1'), ('27', '23', ('1', '2', 1)), (('27', '28', 1), ('23', '24', 1), '2'), ('28', '24', '21'), ('21', '25', '22'), ('22', '26', ('22', '23', 2)), ('g1', 'g3', '23'), ('22', '26', '9'), ('23', '27', '10'), ('9', '3', ('10', '11', 1)), ('10', '4', '11'), ('u2', 'u1', ('11', '12', 1)), ('10', '4', ('11', '12', 3)), ('11', '5', '12'), (('11', '12', 2), ('5', '6', 2), '1'), ('12', '6', '2'), ('1', '7', ('2', '21', 1)), ('2', '8', '21'), ('21', '25', ('21', '22', 1)), ('22', '26', '22'), ('g1', 'g3', ('22', '23', 1)), ('22', '26', '23'), ('23', '27', '9'), ('9', '3', ('9', '10', 1)), ('10', '4', '10'), ('u2', 'u1', ('10', '11', 1)), (('u2', '10', 1), ('u1', '4', 1), '11'), ('10', '4', ('11', '12', 1)), ('11', '5', ('11', '12', 2)), (('11', '12', 2), ('5', '6', 2), '12'), ('12', '6', '1'), ('1', '7', ('1', '2', 1)), ('2', '8', '2'), ('21', '25', ('2', '21', 1)), (('21', '22', 1), ('25', '26', 1), '21'), ('22', '26', ('21', '22', 1)), ('g1', 'g3', ('21', '22', 2)), (('g1', '22', 1), ('g3', '26', 1), '22'), ('22', '26', ('22', '23', 1)), ('23', '27', '23'), ('9', '3', ('23', '9', 1)), ('10', '4', '9'), ('u2', 'u1', ('9', '10', 1)), (('u2', '10', 1), ('u1', '4', 1), '10'), ('10', '4', ('10', '11', 1)), ('11', '5', '11'), ('12', '6', '12'), ('1', '7', ('12', '1', 1)), ('2', '8', '1'), ('21', '25', ('1', '2', 1)), (('21', '22', 1), ('25', '26', 1), '2'), ('22', '26', ('2', '21', 1)), ('g1', 'g3', '21'), ('22', '26', ('21', '22', 2)), (('22', '23', 1), ('26', '27', 1), '22'), ('23', '27', ('22', '23', 1)), ('9', '3', ('22', '23', 2)), ('10', '4', '23'), ('u2', 'u1', ('23', '9', 1)), (('u2', '10', 1), ('u1', '4', 1), '9'), ('10', '4', ('9', '10', 1)), ('11', '5', '10'), (('11', '12', 2), ('5', '6', 2), '11'), ('12', '6', ('11', '12', 2)), ('1', '7', ('11', '12', 3)), ('2', '8', '12'), ('21', '25', ('12', '1', 1)), (('21', '22', 1), ('25', '26', 1), '1'), ('22', '26', ('1', '2', 1)), ('g1', 'g3', '2'), ('22', '26', '21'), ('23', '27', ('21', '22', 2)), ('9', '3', '22'), ('10', '4', ('22', '23', 1)), ('u2', 'u1', ('22', '23', 2)), (('u2', '10', 1), ('u1', '4', 1), '23'), ('10', '4', ('23', '9', 1)), ('11', '5', '9'), (('11', '12', 2), ('5', '6', 2), '10'), ('12', '6', '11'), ('1', '7', ('11', '12', 1)), ('2', '8', ('11', '12', 2)), ('21', '25', ('11', '12', 3)), (('21', '22', 1), ('25', '26', 1), '12'), ('22', '26', ('12', '1', 1)), ('g1', 'g3', '1'), ('22', '26', '2'), ('23', '27', '21'), ('9', '3', ('21', '22', 1)), ('10', '4', ('21', '22', 2)), ('u2', 'u1', '22'), ('10', '4', ('22', '23', 2)), ('11', '5', '23'), (('11', '12', 2), ('5', '6', 2), '9'), ('12', '6', '10'), ('1', '7', ('10', '11', 1)), ('2', '8', '11'), ('21', '25', ('11', '12', 1)), ('22', '26', ('11', '12', 3)), ('g1', 'g3', '12'), ('22', '26', '1'), ('23', '27', '2'), ('9', '3', ('2', '21', 1)), ('10', '4', '21'), ('u2', 'u1', ('21', '22', 1)), ('10', '4', '22'), ('11', '5', ('22', '23', 1)), (('11', '12', 2), ('5', '6', 2), '23'), ('12', '6', '9'), ('1', '7', ('9', '10', 1)), ('2', '8', '10'), ('21', '25', ('10', '11', 1)), (('21', '22', 1), ('25', '26', 1), '11'), ('22', '26', ('11', '12', 1)), ('g1', 'g3', ('11', '12', 2)), ('22', '26', '12'), ('23', '27', '1'), ('9', '3', ('1', '2', 1)), ('10', '4', '2'), ('u2', 'u1', ('2', '21', 1)), (('u2', '10', 1), ('u1', '4', 1), '21'), ('10', '4', ('21', '22', 1)), ('11', '5', ('21', '22', 2)), (('11', '12', 1), ('5', '6', 1), '22'), ('12', '6', '23'), ('1', '7', ('23', '9', 1)), ('2', '8', '9'), ('21', '25', ('9', '10', 1)), (('21', '22', 1), ('25', '26', 1), '10'), ('22', '26', ('10', '11', 1)), ('g1', 'g3', '11'), ('22', '26', ('11', '12', 2)), ('23', '27', '12'), ('9', '3', ('12', '1', 1)), ('10', '4', '1'), ('u2', 'u1', ('1', '2', 1)), (('u2', '10', 1), ('u1', '4', 1), '2'), ('10', '4', ('2', '21', 1)), ('11', '5', '21'), (('11', '12', 3), ('5', '6', 3), '22'), ('12', '6', ('22', '23', 1)), ('1', '7', ('22', '23', 2)), ('2', '8', '23'), ('21', '25', ('23', '9', 1)), (('21', '22', 1), ('25', '26', 1), '9'), ('22', '26', ('9', '10', 1)), ('g1', 'g3', '10'), ('22', '26', '11'), ('23', '27', ('11', '12', 2)), ('9', '3', ('11', '12', 3)), ('10', '4', '12'), ('u2', 'u1', ('12', '1', 1)), (('u2', '10', 1), ('u1', '4', 1), '1'), ('10', '4', ('1', '2', 1)), ('11', '5', '2'), (('11', '12', 2), ('5', '6', 2), '21'), ('12', '6', ('21', '22', 2)), ('1', '7', '22'), ('2', '8', ('22', '23', 1)), ('21', '25', ('22', '23', 2)), (('21', '22', 1), ('25', '26', 1), '23'), ('22', '26', ('23', '9', 1)), ('g1', 'g3', '9'), ('22', '26', '10'), ('23', '27', '11'), ('9', '3', ('11', '12', 1)), ('10', '4', ('11', '12', 2)), ('u2', 'u1', ('11', '12', 3)), (('u2', '10', 1), ('u1', '4', 1), '12'), ('10', '4', ('12', '1', 1)), ('11', '5', '1'), (('11', '12', 2), ('5', '6', 2), '2'), ('12', '6', '21'), ('1', '7', ('21', '22', 1)), ('2', '8', ('21', '22', 2)), ('21', '25', '22')]




run_4_vehicles_case_2 = [('u1', 'u2', '2', '6'), ('4', '10', '21', '7'), ('5', 'u2', '12', '8'), ('27', '10', '1', '25'), (('27', '28', 2), '11', '2', '6'), ('28', ('11', '23', 1), ('2', '21', 1), ('6', '7', 1)), (('28', '21', 1), '23', '21', '7'), ('21', '9', '12', '8'), (('21', '22', 2), '10', '1', '25'), ('22', ('10', '11', 1), ('1', '2', 1), ('25', '6', 1)), (('22', '23', 1), '11', '2', '6'), ('23', '23', '21', '7'), (('23', '24', 2), ('23', '24', 2), '12', '8'), ('24', '24', ('12', '1', 1), ('8', '25', 1)), ('g2', 'g2', '1', '25'), ('24', '24', ('1', '2', 1), ('25', '6', 1)), (('24', '25', 1), ('24', '25', 1), '2', '6'), ('25', '25', '21', '7'), (('25', '26', 2), ('25', '26', 2), '12', '8'), ('26', '26', ('12', '1', 1), ('8', '25', 1)), (('26', '27', 1), ('26', '27', 1), '1', '25'), ('27', '27', '2', '6'), ('3', '3', '21', '7'), ('4', '4', '12', '8'), ('u1', 'u1', '1', '25'), ('4', '4', '2', '6'), ('5', '5', '21', '7'), ('27', '27', '12', '8'), (('27', '28', 2), ('27', '28', 2), '1', '25'), ('28', '28', ('1', '2', 1), ('25', '6', 1)), ('g4', 'g4', '2', '6'), ('28', '28', ('2', '21', 1), ('6', '7', 1)), (('28', '21', 1), ('28', '21', 1), '21', '7'), ('21', '21', '12', '8'), (('21', '22', 2), ('21', '22', 2), '1', '25'), ('22', '22', ('1', '2', 1), ('25', '6', 1)), (('22', '23', 1), ('22', '23', 1), '2', '6'), ('23', '23', '21', '7'), ('9', '9', '12', '8'), ('10', '10', '1', '25'), ('u2', 'u2', '2', '6'), ('10', '10', '21', '7'), ('11', '11', '12', '8'), ('23', '23', '1', '25'), (('23', '24', 2), ('23', '24', 2), '2', '6'), ('24', '24', ('2', '21', 1), ('6', '7', 1)), ('g2', 'g2', '21', '7'), ('24', '24', ('21', '12', 1), ('7', '8', 1)), (('24', '25', 1), ('24', '25', 1), '12', '8'), ('25', '25', '1', '25'), (('25', '26', 2), ('25', '26', 2), '2', '6'), ('26', '26', ('2', '21', 1), ('6', '7', 1)), (('26', '27', 1), ('26', '27', 1), '21', '7'), ('27', '27', '12', '8'), ('3', '3', '1', '25'), ('4', '4', '2', '6'), ('u1', 'u1', '21', '7'), ('4', '4', '12', '8'), ('5', '5', '1', '25'), ('27', '27', '2', '6'), (('27', '28', 2), ('27', '28', 2), '21', '7'), ('28', '28', ('21', '12', 1), ('7', '8', 1)), ('g4', 'g4', '12', '8'), ('28', '28', ('12', '1', 1), ('8', '25', 1)), (('28', '21', 1), ('28', '21', 1), '1', '25'), ('21', '21', '2', '6'), (('21', '22', 2), ('21', '22', 2), '21', '7'), ('22', '22', ('21', '12', 1), ('7', '8', 1)), (('22', '23', 1), ('22', '23', 1), '12', '8'), ('23', '23', '1', '25'), ('9', '9', '2', '6'), ('10', '10', '21', '7'), ('u2', 'u2', '12', '8'), ('10', '10', '1', '25'), ('11', '11', '2', '6'), ('23', '23', '21', '7')]


# Logger configuration
logger = logging.getLogger(__name__)

min_cost = 1
additional_goback_cost = 1

def is_traveling_state(curr_run):
    if type(curr_run) == str:
        return False        # str
    else:
        return True         # traveling state: tuple


def is_traveling_states_intersect(state_1, state_2):
    if is_traveling_state(state_1) and is_traveling_state(state_2):
        state_1_src = list(state_1)[0]
        state_1_dst = list(state_1)[1]

        state_2_src = list(state_2)[0]
        state_2_dst = list(state_2)[1]
        if (state_1_src == state_2_src and state_1_dst == state_2_dst) or \
           (state_1_dst == state_2_src and state_1_src == state_2_dst):
           return True
    else:
        return False

def find_last_non_traveling_state(team_run, agent_id, current_run_seq):
    # find last indivdual state expect for travelling
    for k in range(1, current_run_seq):
        team_state_last = list(team_run[current_run_seq - k])
        if not is_traveling_state(team_state_last[agent_id]):
            return [team_state_last, current_run_seq - k]
    return [None, None]

def find_next_non_traveling_state(team_run, agent_id, current_run_seq):
    # find next indivdual state expect for travelling
    for k in range(1, team_run.__len__() - current_run_seq):
        team_state_next = list(team_run[current_run_seq + k])
        if not is_traveling_state(team_state_next[agent_id]):
            return [team_state_next, current_run_seq + k]
    return [None, None]

def pretty_print(agent_cnt, team_run):
    import string
    # Pretty print the prefix and suffix_cycle on team_ts
    hdr_line_1 = ''
    hdr_line_2 = ''
    for i in range(0, agent_cnt):
        hdr_line_1 += string.ljust('Robot-%d' % (i + 1), 20)
        hdr_line_2 += string.ljust('-------', 20)
    print(hdr_line_1)
    print(hdr_line_2)

    print('*** Team Run: ***')
    for s in team_run:
        line = ''
        for ss in s:
            line += string.ljust('%s' % (ss,), 20)
        print(line)

def check_remove_collisions(ts_tuple, is_modifible, team_run):

    pretty_print(ts_tuple.__len__(), team_run)

    ###
    ''' Check if collision '''
    '''
    # pop the start of suffix to remove repetance
    suffix_cycle_on_team_ts.pop(0)
    team_run = list(prefix_on_team_ts + suffix_cycle_on_team_ts)

    # according to definitions, collision should always be identified in those non-travelling points
    to_pop = []
    # calculate those all-travelling-state points
    for i in range(0, team_run.__len__()):
        travelling_state_num = 0
        for j in range(0, ts_tuple.__len__()):
            if is_traveling_state(team_run[i][j]):
                travelling_state_num += 1
        if travelling_state_num == ts_tuple.__len__():
            to_pop.append(team_run[i])
    # remove from team run
    for i in range(0, to_pop.__len__()):
        team_run.remove(to_pop[i])
    '''

    #
    is_singleton_collision = False
    is_pairwise_collision  = False
    is_rear_end_collision  = False
    singleton_collision_list = [ [False for i in range(ts_tuple.__len__())] for j in range(team_run.__len__()) ]
    pairwise_collision_list  = [ [False for i in range(ts_tuple.__len__())] for j in range(team_run.__len__()) ]
    rear_end_collision_list  = [[False for i in range(ts_tuple.__len__())] for j in range(team_run.__len__())]

    ''' singleton_collision '''
    num_singleton_collision = 0
    for i in range(0, team_run.__len__()):
        curr_run = list(team_run[i])
        for j in range(0, curr_run.__len__()):
            for k in range(0, curr_run.__len__()):
                if j != k and curr_run[j] == curr_run[k] and not is_traveling_state(curr_run[j]):
                    is_singleton_collision = True
                    singleton_collision_list[i][j] = True
                    singleton_collision_list[i][k] = True
                    num_singleton_collision += 1

    ''' pairwise_collision '''
    num_pairwise_collision = 0
    for i in range(0, team_run.__len__()):
        for j in range(0, ts_tuple.__len__()):              # agent j
            # find current non-travelling state for agent j
            curr_run = list(team_run[i])
            curr_run_j = curr_run[j]
            if is_traveling_state(curr_run_j):
                # if current run is traveling state

                for k in range(0, ts_tuple.__len__()):
                    if k == j:
                        continue
                    curr_run_k = curr_run[k]
                    if is_traveling_state(curr_run_k):
                        l = i + 1
                        next_run = list(team_run[l])
                        next_run_j = next_run[j]
                        next_run_k = next_run[k]

                        # find the next, non-travelling state for agent k
                        #if is_traveling_state(next_run_j) and is_traveling_state(next_run_k):     # find next traveling state
                        #    if is_traveling_states_intersect(curr_run_j, next_run_k) and \
                        #       is_traveling_states_intersect(curr_run_k, next_run_j):
                        if is_traveling_state(next_run_k):
                           if is_traveling_states_intersect(curr_run_j, next_run_k):
                                # now can confirm pairwise collision
                                [last_run_j_nt, last_seq_j] = find_last_non_traveling_state(team_run, j, i)
                                [last_run_k_nt, last_seq_k] = find_last_non_traveling_state(team_run, k, i)
                                [next_run_j_nt, next_seq_j] = find_next_non_traveling_state(team_run, j, i)
                                [next_run_k_nt, next_seq_k] = find_next_non_traveling_state(team_run, k, i)

                                if next_run_k_nt[k] == last_run_j_nt[j] and next_run_j_nt[j] == last_run_k_nt[k]:
                                    if last_run_j_nt != None and last_run_k_nt != None and next_run_j_nt != None and next_run_k_nt != None:
                                        is_pairwise_collision = True
                                        pairwise_collision_list[last_seq_j][j] = [next_run_k_nt[k], next_seq_k, k]
                                        pairwise_collision_list[last_seq_k][k] = [next_run_j_nt[j], next_seq_j, j]
                                        pairwise_collision_list[next_seq_j][j] = [last_run_k_nt[k], last_seq_k, k]
                                        pairwise_collision_list[next_seq_k][k] = [last_run_j_nt[j], last_seq_j, j]
                                        num_pairwise_collision += 1
            else:
                # if current run of both agent is actual state:

                for k in range(0, ts_tuple.__len__()):  # agent k
                    if k == j:
                        continue
                    curr_run_k = curr_run[k]
                    if not is_traveling_state(curr_run_k):
                        [next_run_j, next_seq_j] = find_next_non_traveling_state(team_run, j, i)
                        [next_run_k, next_seq_k] = find_next_non_traveling_state(team_run, k, i)
                        if next_run_j != None and next_run_k != None:
                            if curr_run_k == next_run_j[j] and next_run_k[k] == curr_run_j:   # next_seq_k == next_seq_j
                                is_pairwise_collision = True
                                pairwise_collision_list[i][j] = [next_run_k[k], next_seq_k, k]
                                pairwise_collision_list[i][k] = [next_run_j[j], next_seq_j, j]
                                pairwise_collision_list[next_seq_j][j] = [curr_run_k, i, k]
                                pairwise_collision_list[next_seq_k][k] = [curr_run_j, i, j]
                                num_pairwise_collision += 1

    ''' rear-end collisions '''
    num_rear_end_collision = 0
    for i in range(0, team_run.__len__()):
        for j in range(0, ts_tuple.__len__()):              # agent j
            # find current non-travelling state for agent j
            curr_run = list(team_run[i])
            if is_traveling_state(curr_run[j]):
                # if current run is traveling state
                for k in range(0, ts_tuple.__len__()):          # agent k
                    if k == j:
                        continue
                    if not is_traveling_state(curr_run[k]) and list(curr_run[j])[0] == curr_run[k]:
                        # if the origin of traveling state is equal to the other non-traveling state
                        [last_run_j_nt, last_seq_j] = find_last_non_traveling_state(team_run, j, i)
                        [run_j, seq_j] = find_next_non_traveling_state(team_run, j, i)      # the end of the traveling state
                        [run_k, seq_k] = find_next_non_traveling_state(team_run, k, i)      # next non-traveling state of agent k from i

                        if run_j != None and run_k != None and last_run_j_nt != None and \
                           list(curr_run[j])[1] == run_k[k] and seq_j > seq_k:
                            # check wether agent k arrives the end earlier than agnent j
                            is_rear_end_collision = True
                            rear_end_collision_list[i][j] = [curr_run[k],      i,          k, 'lo']   # [the_state_of_the_agents_collited, state_seq_of_the_other_agents, the_other_agent_id, speed_of_the_current_agent]
                            pairwise_collision_list[i][k] = [last_run_j_nt[j], last_seq_j, j, 'hi']
                            rear_end_collision_list[seq_j][j] = [run_k, seq_k, k, 'lo']
                            rear_end_collision_list[seq_k][k] = [run_j, seq_j, j, 'hi']
                            num_rear_end_collision += 1  # only a half need to be done, because the other half will be completed in the whole process, just Fix this below

    print('[collision] Number singleton collision: ', num_singleton_collision)
    print('[collision] Number pairwise  collision: ', num_pairwise_collision)
    print('[collision] Number rear-end  collision: ', num_rear_end_collision)

    ''' singleton_collision '''
    if is_singleton_collision:
        # add stay motion for collision points
        for i in range(0, singleton_collision_list.__len__()):
            for j in range(0, ts_tuple.__len__()):
                if singleton_collision_list[i][j] == True:
                    team_state_curr = list(team_run[i])
                    team_state_last = None
                    team_state_next = None

                    # find last indivdual state expect for travelling
                    for k in range(1, i):
                        team_state_last = list(team_run[i - k])
                        if not is_traveling_state(team_state_last[j]):
                            break
                    # find next indivdual state expect for travelling
                    for k in range(1, team_run.__len__() - i):
                        team_state_next = list(team_run[i + k])
                        if not is_traveling_state(team_state_next[j]):
                            break

                    if not is_traveling_state(team_state_curr[j]) and is_modifible[j]:
                        if is_modifible[j]:
                            if team_state_last != None:
                                # avoid adding the same edge to reduce states
                                if ts_tuple[j].g.edge[team_state_last[j]].get(team_state_last[j]) == None:
                                    ts_tuple[j].g.add_edge(team_state_last[j], team_state_last[j],
                                                           attr_dict={'weight': min_cost, 'control': 's'})
                            if team_state_next != None:
                                if ts_tuple[j].g.edge[team_state_next[j]].get(team_state_next[j]) == None:
                                    ts_tuple[j].g.add_edge(team_state_next[j], team_state_next[j],
                                                           attr_dict={'weight': min_cost, 'control': 's'})

    ''' pairwise_collision '''
    if is_pairwise_collision:
        # add turn-back points
        for i in range(0, pairwise_collision_list.__len__()):
            for j in range(0, ts_tuple.__len__()):
                if pairwise_collision_list[i][j] != False:

                    team_state_curr = list(team_run[i])
                    team_state_last = None
                    team_state_next = None

                    # find last indivdual state expect for travelling
                    for k in range(1, i):
                        team_state_last = list(team_run[i - k])
                        if not is_traveling_state(team_state_last[j]):
                            break
                    # find next indivdual state expect for travelling
                    for k in range(1, team_run.__len__() - i):
                        team_state_next = list(team_run[i + k])
                        if not is_traveling_state(team_state_next[j]):
                            break

                    if is_modifible[j]:
                        ''' FIRST, add go-back points '''
                        # find ALL edges to target state
                        go_back_list = []       # for go_back_list[i], [0] for node and [1] for cost
                        for u in ts_tuple[j].g.edge:
                            if ts_tuple[j].g.edge[u].get(team_state_last[j]) != None:
                                go_back_list.append([u, ts_tuple[j].g.edge[u].get(team_state_last[j])[0]['weight'] + additional_goback_cost])   # record point and corresponding weight

                        min_cost_index = 0
                        for k in range(0, go_back_list.__len__()):
                            if go_back_list[k][1] <= go_back_list[min_cost_index][1]:
                                min_cost_index = k

                        # if the go back edge does not exist, add it
                        if ts_tuple[j].g.edge[team_state_last[j]].get(go_back_list[min_cost_index][0]) == None:
                            ts_tuple[j].g.add_edge(team_state_last[j], go_back_list[min_cost_index][0],
                                                   attr_dict={'weight': go_back_list[min_cost_index][1], 'control': 'go_back'})

                        ''' SECOND, add wait points '''
                        if team_state_next != None:
                            if ts_tuple[j].g.edge[team_state_next[j]].get(team_state_next[j]) == None:
                                ts_tuple[j].g.add_edge(team_state_next[j], team_state_next[j],
                                                       attr_dict={'weight': min_cost, 'control': 's'})

def main():
    r1 = Ts.load('./robot_1.yaml')  # robot_1_real.yaml
    r2 = Ts.load('./robot_2.yaml')  # robot_2_real.yaml
    r3 = Ts.load('./robot_3.yaml')  # robot_3_real.yaml

    # CASE 2
    ts_tuple = (r1, r2, r3)
    is_modifible = [True, True, False]

    check_remove_collisions(ts_tuple, is_modifible, run_case_3_inv)

if __name__ == '__main__':
    main()
